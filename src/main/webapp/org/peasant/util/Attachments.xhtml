<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"      
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Facelet Title</title>
        <f:loadBundle var="i18nBundle" basename="/org/peasant/util/i18n" />
        #{attachmentController.setOwner(param['owner'])}

    </h:head>
    <h:body>
        <p:growl id="growl" autoUpdate="true" showDetail="true" />

        <h:form prependId="false">
            <p:fileUpload multiple="true" mode="advanced" fileUploadListener="#{attachmentController.handleFileUpload}" update=":AttachsForm" />
        </h:form>
        <h:form id="AttachsForm">            
            <p:dataTable id="datalist" value="${attachmentController.getAttachments()}" var="item"
                         selection="#{attachmentController.selecteds}"
                         rowKey="#{item.ID}"
                         rowsPerPageTemplate="10,20,30,40,50"
                         paginator="true" paginatorPosition="bottom"
                         rows="10"
                         draggableColumns="true" resizableColumns="true" 
                         scrollable="true"   liveResize="true" liveScroll="true"
                         sortMode="multiple"
                         editable="true"                               
                         >


                <f:facet name="header">#{i18nBundle.ListAttachmentTitle} </f:facet>

                <p:column headerText="#{i18nBundle.ListAttachmentTitle_Id}">
                    <h:outputText value="#{item.ID}"/>
                </p:column>
                <p:column headerText="#{i18nBundle.ListAttachmentTitle_Name}">
                    <h:outputText value="#{item.name}"/>
                </p:column>
                <p:column headerText="#{i18nBundle.ListAttachmentTitle_Belonger}">
                    <h:outputText value="#{item.belonger}"/>
                </p:column>
                <p:column headerText="#{i18nBundle.ListAttachmentTitle_Type}">
                    <h:outputText value="#{item.contentType}"/>
                </p:column>
                <p:column headerText="#{i18nBundle.ListAttachmentTitle_Size}">
                    <h:outputText value="#{item.size}"/>
                </p:column>
                <p:column headerText="#{i18nBundle.ListAttachmentTitle_Attacher}">
                    <h:outputText value="#{item.attacher}"/>
                </p:column>
                <p:column headerText="#{i18nBundle.ListAttachmentTitle_UploadTime}">
                    <h:outputText value="#{item.uploadTime}"/>
                </p:column>
                <p:column headerText="#{i18nBundle.ListAttachmentTitle_Download}">
                    <p:commandButton value="Download" ajax="false"  icon="ui-icon-arrowthick-1-s">
                        <p:fileDownload value="#{attachmentController.getStreamContent(item)}" />
                    </p:commandButton>
                    <p:graphicImage value="${attachmentController.getResourcePath(item)}"  rendered="${item.contentType.contains('image')}" width="50px"/>
                </p:column>
                
            </p:dataTable>

        </h:form>

    </h:body>
</html>

